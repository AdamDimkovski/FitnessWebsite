<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Profile</title>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="images/favicon.png">
  
  <link rel="stylesheet" href="style-profile.css">

</head>
<body>

<!-- Navigation Bar -->
<nav class="navbar">
  <ul class="nav-list">

    <li class="nav-item">
      <a href="index.html">Home</a>
    </li>

    <li class="nav-item">
      <a href="calculator.html">Maintenance Calculator</a>
    </li>

    <li class="nav-item">
      <a href="food.html">Diet Tracker</a>
    </li>

    <li class="nav-item">
      <a href="exercise.html">Workout Tracker</a>
    </li>

    <!-- Auth‑controlled items -->
    <li class="nav-item" id="signupLink">
      <a href="sign-up.html">Sign Up</a>
    </li>

    <li class="nav-item" id="loginLink">
      <a href="log-in.html">Log In</a>
    </li>

    <li class="nav-item" id="profileLink">
      <a href="profile.html">Profile</a>
    </li>

    <li class="nav-item" id="logoutLink">
      <a href="#">Log Out</a>
    </li>

  </ul>
</nav>

  <h1>My Profile</h1>
  <p>Below are your account details</p>

  <!-- Profile Display Section -->
  <div class="profile-container">

    <h3>Personal Info</h3>
    <div class="profile-grid">
      <p><strong>Name:</strong> <span id="profileName"></span></p>
      <p><strong>Age:</strong> <span id="profileAge"></span></p>
      <p><strong>Goal:</strong> <span id="profileGoal"></span></p>
      <p><strong>Email:</strong> <span id="profileEmail"></span></p>
    </div>

    <hr>

    <h3>Physical Stats</h3>
    <div class="profile-grid">
      <p><strong>Height:</strong> <span id="profileHeight"></span></p>
      <p><strong>Weight:</strong> <span id="profileWeight"></span></p>
      <p><strong>Target Weight:</strong> <span id="profileTargetWeight"></span></p>
      <p><strong>Gender:</strong> <span id="profileGender"></span></p>
      <p><strong>Activity Level:</strong> <span id="profileActivity"></span></p>
    </div>

    <hr>

    <h3>Daily Targets</h3>
    <div class="profile-grid">
      <p><strong>Calories:</strong> <span id="targetCalories"></span></p>
      <p><strong>Protein:</strong> <span id="targetProtein"></span> g</p>
      <p><strong>Carbs:</strong> <span id="targetCarbs"></span> g</p>
      <p><strong>Fat:</strong> <span id="targetFat"></span> g</p>
      <p><strong>Water:</strong> <span id="targetWater"></span> L</p>
    </div>

    <hr>

    <h3>Account Info</h3>
    <p><strong>Member Since:</strong> <span id="profileCreated"></span></p>
  </div>

    <!-- Firebase App (compat version) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>

  <!-- Firebase Authentication (compat version) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <!-- Firebase Firestore (compat version) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Scripts -->
  <script src="firebase.js"></script>
  <script src="script.js"></script>


  <!-- Profile JS -->
<script>
  firebase.auth().onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = "log-in.html";
      return;
    }

    try {
      const db = firebase.firestore();
      const docRef = db.collection("users").doc(user.uid);
      const docSnap = await docRef.get();

      if (!docSnap.exists) {
        console.warn("No profile data found.");
        fillAllWithNA();
        return;
      }

      const data = docSnap.data();

      /* PERSONAL INFO */
      setText("profileName", safe(data.name));
      setText("profileAge", safe(data.age));
      setText("profileGoal", formatText(data.goal));
      setText("profileEmail", safe(data.email, user.email));

      /* PHYSICAL STATS */
      setText("profileHeight", safe(data.height, " cm"));
      setText("profileWeight", safe(data.weight, " kg"));
      setText("profileTargetWeight", safe(data.targetWeight, " kg"));
      setText("profileGender", safe(data.gender));
      if(data.activityLevel === 1.2) {
        setText("profileActivity", "Sedentary");
      }
      else if(data.activityLevel === 1.375) {
        setText("profileActivity", "Lightly Active");
      }
      else if(data.activityLevel === 1.55) {
        setText("profileActivity", "Moderately Active");
      }
      else if(data.activityLevel === 1.725) {
        setText("profileActivity", "Very Active");
      }
      else if(data.activityLevel === 1.9) {
        setText("profileActivity", "Super Active");
      }
      else {
        setText("profileActivity", "N/A");
      }

      /* DAILY TARGETS */
      setText("targetCalories", safe(data.targetCalories));
      setText("targetProtein", safe(data.targetProtein, ""));
      setText("targetCarbs", safe(data.targetCarbs, ""));
      setText("targetFat", safe(data.targetFat, ""));

      // Water (stored as mL → display as L)
      const waterLitres =
        typeof data.targetWater === "number"
          ? (data.targetWater / 1000).toFixed(1)
          : data.targetWater;

      setText("targetWater", safe(waterLitres, ""));

      /* ACCOUNT INFO */
      if (data.createdAt?.toDate) {
        setText(
          "profileCreated",
          data.createdAt.toDate().toLocaleDateString()
        );
      } else {
        setText("profileCreated", "N/A");
      }

    } catch (err) {
      console.error("Profile load error:", err);
      fillAllWithNA();
    }
  });

  /* HELPERS */

  function safe(value, fallbackOrSuffix = "") {
    if (value === undefined || value === null || value === "") {
      return fallbackOrSuffix && fallbackOrSuffix.includes("@")
        ? fallbackOrSuffix
        : "N/A";
    }

    if (typeof fallbackOrSuffix === "string" && fallbackOrSuffix.startsWith(" ")) {
      return `${value}${fallbackOrSuffix}`;
    }

    return value;
  }

  function setText(id, value) {
    const el = document.getElementById(id);
    if (el) el.textContent = value ?? "N/A";
  }

  function formatText(value) {
    if (typeof value !== "string") return "N/A";
    return value
      .replace(/_/g, " ")
      .replace(/\b\w/g, (c) => c.toUpperCase());
  }

  function fillAllWithNA() {
    document.querySelectorAll("span[id]").forEach(span => {
      span.textContent = "N/A";
    });
  }
</script>

<script>
auth.onAuthStateChanged(user => {
updateUIForAuthState(user);
});
</script>

<!-- Footer -->
<footer class="page-footer">
  <span class="footer-text">Litness</span>
</footer>

</body>
</html>